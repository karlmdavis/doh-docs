--- 
title: Network Clients for justdavis.com
kind: topic
summary: "Describes the steps necessary to make workstations a part of the justdavis.com network."
---


# <%= @item[:title] %>

This guide describes the steps necessary to make make workstations a part of the `justdavis.com` network. The network provides the following services:

* Kerberos Authentication: Used by Windows and Linux workstations to authenticate login user names and passwords. Also allows for Single-Sign-On to various services.
    * The configuration of this service is described in the following guide: <%= topic_link("/it/davis/servers/eddings/kerberos/") %>
* LDAP Directory: Used by Linux workstations to determine centralize users and groups.
    * The configuration of this service is described in the following guide: <%= topic_link("/it/davis/servers/eddings/ldap/") %>
* OpenAFS File Server: Used by Windows and Linux workstations as a centralized file server.

Previously, workstations had been joined to the `davisonlinehome.name` network. It provided the same services, but has since been decommissioned in favor of the new `justdavis.com` network.


## Windows Vista


### Kerberos Login Setup

References:

* <http://web.mit.edu/Kerberos/kfw-3.2/kfw-3.2.2/relnotes.html#mslsa>
* <http://technet.microsoft.com/en-us/library/cc738673.aspx>

Windows Vista has basic support for Kerberos logins. However, it does not support the use of LDAP directories, so user accounts will have to be manually created and mapped to their corresponding Kerberos identities.

Install all required dependencies:

1. Heimdal Kerberos for Windows:
    1. Download the latest version from [Heimdal Kerberos from Secure Endpoints](https://www.secure-endpoints.com/heimdal/).
    1. Install it.
1. Windows Server 2003 Support Tools:
    1. Download from <http://www.microsoft.com/downloads/details.aspx?FamilyId=6EC50B78-8BE1-4E81-B3BE-4E7AC4F0912D&displaylang=en>.
    1. Install.
1. Windows Server 2003 Resource Kit:
    1. Download from <http://www.microsoft.com/downloads/details.aspx?familyid=9d467a69-57ff-4ae7-96ee-b18c4790cffd&displaylang=en>.
    1. Install.

Create Kerberos `host` and `cifs` principals for the computer's hostname and FQDN (four principals total). For these principals, it is recommended that you create a very complex randomized password. This password will need to be written down (it will be used again later) and should be the same for all four principals created. This process will likely have to be done on a Linux workstation that can connect to the Kerberos server (replace `hostname` and `hostname.domain` with the computer's hostname and FQDN, respectively):

~~~~
$ kadmin -p karl/admin
kadmin:  addprinc -policy hosts host/hostname.domain
kadmin:  addprinc -policy hosts host/hostname
kadmin:  addprinc -policy hosts cifs/hostname.domain
kadmin:  addprinc -policy hosts cifs/hostname
~~~~

Please note: generally, it's a good idea to use the `-randkey` flag to `addprinc`. However, there's no way to capture the password generated by that, and we will need to enter the password manually on the Windows computer. In addition, it's generally a bad idea to re-use passwords between principals. However, in this case the other three principals are equivalent to aliases of the `host` principal for the FQDN so it seems reasonable.

TODO: Verify the extra principals are actually needed. Right now, `brooks` and `adams` both only have the one `host/hostname.domain` principal, and both seem to be working just fine.

Configure Kerberos authentication for the client workstation. The following commands must be run from a **Command Prompt** that has been launched by right-clicking the application icon and selecting **Run as administrator** (ignore comment lines starting with a `#`):

~~~~
# Add the realm and KDC (via DNS):
> KSETUP /AddKdc JUSTDAVIS.COM kerberos.justdavis.com
# Add the Kerberos admin server:
> KSETUP /AddKpasswd JUSTDAVIS.COM kerberos.justdavis.com
# Assign the realm:
> KSETUP /SetRealm JUSTDAVIS.COM
# Set the computer's host principal password (replace <Password> with the password created earlier for the host/hostname.domain principal):
> KSETUP /SetComputerPassword "<Password>"
# Map realm principals to local accounts of the same name:
> KSETUP /MapUser * *
~~~~

Local user accounts should be created for each network user that will be logging in to the workstation. For example, a local user account named `karl` should be created if the `karl@JUSTDAVIS.COM` network user will be using the workstation, `erica` for `erica@JUSTDAVIS.COM`, etc. These user accounts can be used in one of two modes:

* `.\username` or `hostname\username`: Login to local user account only, where the '`.`' is an abbreviation for the local workstation's hostname. If users login using a username of this form, they will need to use the local user account's password (if any) and will have access to any files stored in the local user account. They will not have access to any resources secured by the network user account, e.g. AFS servers.
* `username@JUSTDAVIS.COM`: Login to network identity under the local user account. If users login using a username of this form, they will need to use the Kerberos principal's password and will have access to resources available to both the local user account and any resources accessible to the Kerberos user.

Before logging in, the computer must be restarted for the `KSETUP` commands above to be applied. Please note that further setup will be needed for most Kerberos-secured network resources to become available. See the section(s) below for more information.


### OpenAFS Setup

The OpenAFS project provides extensive support for Windows clients in addition to Linux ones. This support requires the installation and configuration of three components:

* a Kerberos API provider, e.g. Heimdal or MIT
* the Network Identity Manager application
* the OpenAFS client libraries and applications

Of the two Windows Kerberos libraries available, Heimdal and Kerberos, Heimdal seems to be the better choice. Download and install the latest release for your architecture from the following page: [Heimdal Kerberos for Windows from Secure Endpoints](https://www.secure-endpoints.com/heimdal/).

After installation, add the following entry to `[libdefaults]` section of the `%SystemRoot%:\ProgramData\Kerberos` file:

~~~~
	allow_weak_crypto = true
~~~~

Then, download and install the latest release of the Network Identity Manager application from the following page: [Network Identity Manager Version 2.0 from Secure Endpoints](https://www.secure-endpoints.com/netidmgr/v2/index.html).

Finally, download and install the latest release of OpenAFS for Windows for the workstation's architecture from the following page: <http://www.openafs.org/windows.html>. When prompted, select the following options:

* Setup Type: IFS Based Client
* Default Cell: `justdavis.com`
* Integrated logon: Enable
* AFS crypt security: Enable
* Freelance mode: Enable
* Lookup cells in DNS: Enable

TODO: This guide may be incomplete, as it has not been tested yet.

